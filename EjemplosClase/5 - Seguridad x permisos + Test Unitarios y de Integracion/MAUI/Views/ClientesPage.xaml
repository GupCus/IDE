<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MAUI.Views.ClientesPage"
             Title="Clientes">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <!-- Header con botón Agregar -->
        <StackLayout Grid.Row="0" Orientation="Horizontal" Padding="10" BackgroundColor="LightGray">
            <Label Text="Clientes" FontSize="24" FontAttributes="Bold" VerticalOptions="Center" HorizontalOptions="StartAndExpand"/>
            <Button Text="Agregar" 
                    Command="{Binding AgregarCommand}"
                    IsVisible="{Binding CanAdd}"
                    BackgroundColor="DodgerBlue" 
                    TextColor="White"
                    CornerRadius="5"/>
        </StackLayout>
        
        <!-- Lista de clientes -->
        <RefreshView Grid.Row="1" 
                     IsRefreshing="{Binding IsLoading}" 
                     Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding Clientes}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="10,5" 
                               Padding="15" 
                               BackgroundColor="White" 
                               HasShadow="True"
                               CornerRadius="8">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                
                                <!-- Nombre completo -->
                                <Label Grid.Row="0" 
                                       FontSize="18" 
                                       FontAttributes="Bold" 
                                       TextColor="Black">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding Nombre}" />
                                            <Span Text=" " />
                                            <Span Text="{Binding Apellido}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                
                                <!-- Email -->
                                <Label Grid.Row="1" 
                                       Text="{Binding Email}" 
                                       FontSize="14" 
                                       TextColor="Gray"
                                       Margin="0,2"/>
                                
                                <!-- País -->
                                <Label Grid.Row="2" 
                                       Text="{Binding PaisNombre, StringFormat='País: {0}'}" 
                                       FontSize="14" 
                                       TextColor="Gray"
                                       Margin="0,2"/>
                                
                                <!-- ID y Fecha -->
                                <StackLayout Grid.Row="3" Orientation="Horizontal" Margin="0,2">
                                    <Label Text="{Binding Id, StringFormat='ID: {0}'}" 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                    <Label Text=" • " 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                    <Label Text="{Binding FechaAlta, StringFormat='{0:dd/MM/yyyy HH:mm:ss}'}" 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                </StackLayout>
                                
                                <!-- Separador -->
                                <BoxView Grid.Row="4" 
                                         Height="1" 
                                         BackgroundColor="LightGray" 
                                         Margin="0,10"/>
                                
                                <!-- Botones -->
                                <StackLayout Grid.Row="5" 
                                           Orientation="Horizontal" 
                                           HorizontalOptions="End"
                                           Spacing="10">
                                    <Button Text="Editar" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditarCommand}"
                                            CommandParameter="{Binding}"
                                            IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.CanUpdate}"
                                            BackgroundColor="Orange" 
                                            TextColor="White"
                                            FontSize="14"
                                            Padding="15,8"
                                            CornerRadius="5"/>
                                    <Button Text="Eliminar" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EliminarCommand}"
                                            CommandParameter="{Binding}"
                                            IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.CanDelete}"
                                            BackgroundColor="Red" 
                                            TextColor="White"
                                            FontSize="14"
                                            Padding="15,8"
                                            CornerRadius="5"/>
                                </StackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
        
        <!-- Loading indicator -->
        <ActivityIndicator Grid.Row="1" 
                          IsVisible="{Binding IsLoading}" 
                          IsRunning="{Binding IsLoading}"
                          VerticalOptions="Center" 
                          HorizontalOptions="Center"
                          Color="DodgerBlue"/>
    </Grid>
</ContentPage>